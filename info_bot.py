import os
import asyncio
from dotenv import load_dotenv
from telegram import Bot
from telegram.error import TelegramError

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env
load_dotenv()

# ID –∫–∞–Ω–∞–ª–∞/–≥—Ä—É–ø–ø—ã, –∫—É–¥–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ ID —á–∞—Ç–∞, –≥–¥–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥—Ä—É–ø–ø–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞, –∏–ª–∏ —Å–∞–º–∞ –≥—Ä—É–ø–ø–∞)
CHANNEL_ID_STR = os.getenv('CHANNEL_ID')

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = os.getenv("TOKEN")

async def main():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.
    """
    if not BOT_TOKEN:
        print("–û—à–∏–±–∫–∞: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ (TOKEN) –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ.")
        return
    if not CHANNEL_ID_STR:
        print("–û—à–∏–±–∫–∞: ID –∫–∞–Ω–∞–ª–∞/–≥—Ä—É–ø–ø—ã (CHANNEL_ID) –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ.")
        return

    try:
        # CHANNEL_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (integer)
        channel_id = int(CHANNEL_ID_STR)
    except ValueError:
        print(f"–û—à–∏–±–∫–∞: CHANNEL_ID '{CHANNEL_ID_STR}' –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.")
        return

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
    bot = Bot(token=BOT_TOKEN)

    main_message_text = "ü§ñ –ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞."
    comment_text = "üí¨ –ê —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º!"

    try:
        # 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç ID: {channel_id}...")
        sent_message = await bot.send_message(
            chat_id=channel_id,
            text=main_message_text
        )
        message_id = sent_message.message_id
        print(f"–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ID —Å–æ–æ–±—â–µ–Ω–∏—è: {message_id}")

        # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞, —á—Ç–æ–±—ã Telegram —É—Å–ø–µ–ª –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ)
        await asyncio.sleep(1)

        # 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ—Ç–≤–µ—Ç) –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
        # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —Ç–æ—Ç –∂–µ chat_id, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
        # –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ chat_id - —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –∏–ª–∏ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞,
        # –∏–ª–∏ –µ—Å–ª–∏ —ç—Ç–æ ID –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏—è, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π –∫ –∫–∞–Ω–∞–ª—É.
        print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ —Å–æ–æ–±—â–µ–Ω–∏—é ID: {message_id} –≤ —á–∞—Ç ID: {channel_id}...")
        await bot.send_message(
            chat_id=channel_id,
            text=comment_text,
            reply_to_message_id=message_id
        )
        print("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")

    except TelegramError as e:
        print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ Telegram: {e}")
        print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:")
        print(f"  1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞ '{BOT_TOKEN[:5]}...' –≤–∞–ª–∏–¥–µ–Ω.")
        print(f"  2. –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç/–∫–∞–Ω–∞–ª —Å ID {channel_id}.")
        print(f"  3. –ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π (–∏ –æ—Ç–≤–µ—Ç–æ–≤) –≤ —ç—Ç–æ–º —á–∞—Ç–µ.")
        print(f"  4. –ï—Å–ª–∏ —ç—Ç–æ –∫–∞–Ω–∞–ª, –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –≥—Ä—É–ø–ø–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è, —Ç–æ CHANNEL_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ID —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã.")
    except Exception as e:
        print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ main
    asyncio.run(main())